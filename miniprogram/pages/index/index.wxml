<!--index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="date-info">
      <text class="date">{{currentDate}}</text>
      <text class="practice-time text-secondary">ä»Šæ—¥ç»ƒä¹  {{todayPracticeTime}} åˆ†é’Ÿ</text>
    </view>
    
    <!-- è®¾ç½®æŒ‰é’® -->
    <view class="settings-btn" bindtap="goToSettings">
      <text class="icon">âš™ï¸</text>
    </view>
  </view>

  <!-- å¥å­æ˜¾ç¤ºåŒºåŸŸ -->
  <view class="sentence-area card">
    <view class="sentence-header">
      <text class="sentence-level">{{currentSentence.level}}</text>
      <text class="sentence-count">{{currentIndex + 1}}/{{totalSentences}}</text>
    </view>
    
    <view class="sentence-content">
      <text class="sentence-text">{{currentSentence.content}}</text>
    </view>
    
    <!-- ç¿»è¯‘ï¼ˆå¯å±•å¼€ï¼‰ -->
    <view class="translation" wx:if="{{showTranslation}}">
      <text class="translation-text text-secondary">{{currentSentence.translation}}</text>
    </view>
    
    <!-- å±•å¼€ç¿»è¯‘æŒ‰é’® -->
    <view class="expand-btn" bindtap="toggleTranslation">
      <text class="text-secondary">{{showTranslation ? 'æ”¶èµ·' : 'æ˜¾ç¤º'}}ç¿»è¯‘</text>
    </view>
  </view>

  <!-- æ³¢å½¢å¯è§†åŒ–åŒºåŸŸ -->
  <view class="wave-container">
    <canvas 
      canvas-id="waveCanvas" 
      id="waveCanvas"
      class="wave-canvas"
      style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
    ></canvas>
    
    <!-- å½•éŸ³æ—¶é•¿æ˜¾ç¤º -->
    <view class="record-time" wx:if="{{isRecording || recordDuration > 0}}">
      <text>{{recordDurationText}}</text>
    </view>
  </view>

  <!-- å½•éŸ³æ§åˆ¶åŒºåŸŸ -->
  <view class="record-controls">
    <!-- ä¸»å½•éŸ³æŒ‰é’® -->
    <view class="record-button-container">
      <button 
        class="record-btn {{isRecording ? 'recording' : ''}} {{!recordAuth ? 'disabled' : ''}}"
        bindtouchstart="startRecording"
        bindtouchend="stopRecording"
        disabled="{{!recordAuth}}"
      >
        <view class="record-icon">
          <text wx:if="{{!isRecording}}">ğŸ™ï¸</text>
          <text wx:else class="recording-icon">â¹ï¸</text>
        </view>
        <text class="record-text">
          {{isRecording ? 'å½•éŸ³ä¸­' : (recordAuth ? 'æŒ‰ä½å½•éŸ³' : 'éœ€è¦æƒé™')}}
        </text>
      </button>
    </view>

    <!-- æ“ä½œæŒ‰é’®ç»„ -->
    <view class="action-buttons">
      <!-- æ’­æ”¾æŒ‰é’® -->
      <button 
        class="action-btn" 
        bindtap="playRecording"
        disabled="{{!hasRecording}}"
      >
        <text class="action-icon">â–¶ï¸</text>
        <text class="action-text">æ’­æ”¾</text>
      </button>

      <!-- ä¸‹ä¸€å¥æŒ‰é’® -->
      <button class="action-btn" bindtap="nextSentence">
        <text class="action-icon">â­ï¸</text>
        <text class="action-text">ä¸‹ä¸€å¥</text>
      </button>

      <!-- é‡æ–°å½•éŸ³æŒ‰é’® -->
      <button 
        class="action-btn" 
        bindtap="resetRecording"
        disabled="{{!hasRecording}}"
      >
        <text class="action-icon">ğŸ”„</text>
        <text class="action-text">é‡å½•</text>
      </button>
    </view>
  </view>

  <!-- ç»ƒä¹ ç»Ÿè®¡ -->
  <view class="practice-stats card">
    <view class="stats-item">
      <text class="stats-number">{{practiceStats.sentenceCount}}</text>
      <text class="stats-label">ä»Šæ—¥å¥æ•°</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-number">{{practiceStats.totalTime}}</text>
      <text class="stats-label">æ€»æ—¶é•¿</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-number">{{practiceStats.bestScore || '--'}}</text>
      <text class="stats-label">æœ€ä½³è¯„åˆ†</text>
    </view>
  </view>

  <!-- æƒé™ç”³è¯·æç¤º -->
  <view class="auth-modal" wx:if="{{showAuthModal}}">
    <view class="auth-content">
      <text class="auth-title">éœ€è¦å½•éŸ³æƒé™</text>
      <text class="auth-desc">è¯·å…è®¸ä½¿ç”¨éº¦å…‹é£è¿›è¡Œå£è¯­ç»ƒä¹ </text>
      <view class="auth-buttons">
        <button class="btn btn-secondary" bindtap="hideAuthModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="requestAuth">æˆæƒ</button>
      </view>
    </view>
  </view>
</view> 