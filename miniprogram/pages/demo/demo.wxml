<!--Demo页面界面-->
<view class="demo-container">
  <!-- 头部标题 -->
  <view class="demo-header">
    <text class="demo-title">🎬 P-Word 功能验收Demo</text>
    <view class="demo-subtitle">Day {{currentDay}} - 开发成果展示</view>
  </view>

  <!-- Tab导航 -->
  <view class="demo-tabs">
    <view 
      wx:for="{{tabs}}" 
      wx:key="name"
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      data-index="{{index}}"
      bindtap="switchTab"
    >
      <text class="tab-icon">{{item.icon}}</text>
      <text class="tab-name">{{item.name}}</text>
    </view>
  </view>

  <!-- 录音功能测试 -->
  <view class="tab-content" wx:if="{{currentTab === 0}}">
    <view class="section-title">🎤 录音功能测试</view>
    
    <!-- 录音控制 -->
    <view class="record-controls">
      <button 
        class="record-btn {{isRecording ? 'recording' : ''}}"
        bindtap="startRecordingTest"
        disabled="{{isRecording}}"
      >
        {{isRecording ? '录音中...' : '开始录音'}}
      </button>
      
      <button 
        class="stop-btn"
        bindtap="stopRecordingTest"
        disabled="{{!isRecording}}"
      >
        停止录音
      </button>
      
      <button 
        class="play-btn"
        bindtap="playRecordingTest"
        disabled="{{!hasRecording}}"
      >
        播放测试
      </button>
    </view>

    <!-- 录音状态 -->
    <view class="record-status">
      <view class="status-item">
        <text class="label">录音时长:</text>
        <text class="value">{{recordDuration}}秒</text>
      </view>
      <view class="status-item" wx:if="{{audioQuality}}">
        <text class="label">质量评分:</text>
        <text class="value quality-{{audioQuality.level}}">{{audioQuality.overall}}分</text>
      </view>
    </view>

    <!-- 波形显示 -->
    <view class="waveform-container">
      <view class="waveform-title">实时波形</view>
      <view class="waveform-display">
        <view 
          wx:for="{{waveData}}" 
          wx:key="index"
          class="wave-bar"
          style="height: {{item * 50}}px;"
        ></view>
      </view>
    </view>

    <!-- 测试结果 -->
    <view class="test-results">
      <view class="result-title">测试结果</view>
      <view class="result-grid">
        <view class="result-item">
          <text class="result-label">录音功能</text>
          <text class="result-status {{testResults.recording ? 'success' : 'pending'}}">
            {{testResults.recording || '待测试'}}
          </text>
        </view>
        <view class="result-item">
          <text class="result-label">质量分析</text>
          <text class="result-status {{testResults.quality ? 'success' : 'pending'}}">
            {{testResults.quality ? testResults.quality + '分' : '待测试'}}
          </text>
        </view>
        <view class="result-item">
          <text class="result-label">音频播放</text>
          <text class="result-status {{testResults.playback ? 'success' : 'pending'}}">
            {{testResults.playback || '待测试'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 语料库功能测试 -->
  <view class="tab-content" wx:if="{{currentTab === 1}}">
    <view class="section-title">📚 语料库系统测试</view>
    
    <!-- 推荐模式测试 -->
    <view class="recommendation-tests">
      <view class="test-buttons">
        <button class="test-btn smart" bindtap="testSmartRecommendation">
          🧠 智能推荐
        </button>
        <button class="test-btn random" bindtap="testRandomRecommendation">
          🔀 随机推荐
        </button>
      </view>
      
      <!-- 分类筛选 -->
      <view class="category-filters">
        <text class="filter-title">分类筛选:</text>
        <scroll-view class="category-scroll" scroll-x>
          <view 
            wx:for="{{availableCategories}}" 
            wx:key="*this"
            class="category-tag {{selectedCategory === item ? 'active' : ''}}"
            data-category="{{item}}"
            bindtap="testCategoryFilter"
          >
            {{item}}
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- 当前句子展示 -->
    <view class="sentence-display" wx:if="{{currentSentence}}">
      <view class="sentence-card">
        <view class="sentence-content">{{currentSentence.content}}</view>
        <view class="sentence-translation">{{currentSentence.translation}}</view>
        <view class="sentence-meta">
          <text class="level">{{currentSentence.level}}</text>
          <text class="category">{{currentSentence.category}}</text>
          <text class="difficulty">难度: {{currentSentence.difficulty}}</text>
        </view>
      </view>
    </view>

    <!-- 语料库统计 -->
    <view class="sentence-stats">
      <view class="stats-title">语料库统计</view>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{sentenceStats.total}}</text>
          <text class="stat-label">总句数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{availableCategories.length}}</text>
          <text class="stat-label">分类数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{recommendationMode}}</text>
          <text class="stat-label">推荐模式</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 云同步功能测试 -->
  <view class="tab-content" wx:if="{{currentTab === 2}}">
    <view class="section-title">☁️ 云同步功能测试</view>
    
    <!-- 同步状态 -->
    <view class="sync-status">
      <view class="status-card">
        <view class="status-icon">{{syncStatus.isOnline ? '☁️' : '📱'}}</view>
        <view class="status-text">{{syncStatus.isOnline ? '在线' : '离线'}}</view>
        <view class="queue-info">队列: {{syncStatus.queueLength}}条</view>
      </view>
    </view>

    <!-- 同步测试按钮 -->
    <view class="sync-tests">
      <button class="sync-btn online" bindtap="testOnlineSync">
        测试在线同步
      </button>
      <button class="sync-btn offline" bindtap="testOfflineMode">
        测试离线模式
      </button>
      <button class="sync-btn manual" bindtap="testManualSync">
        测试手动同步
      </button>
    </view>

    <!-- 同步测试结果 -->
    <view class="sync-results" wx:if="{{syncTestResults.length > 0}}">
      <view class="results-title">同步测试结果</view>
      <view class="results-list">
        <view 
          wx:for="{{syncTestResults}}" 
          wx:key="time"
          class="result-row"
        >
          <text class="test-name">{{item.name}}</text>
          <text class="test-status {{item.success ? 'success' : 'failed'}}">
            {{item.success ? '✅' : '❌'}}
          </text>
          <text class="test-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 数据分析页面 -->
  <view class="tab-content" wx:if="{{currentTab === 3}}">
    <view class="section-title">📊 数据分析展示</view>
    
    <!-- 统计卡片 -->
    <view class="stats-cards">
      <view class="stat-card">
        <view class="stat-number">{{statistics.totalPractices}}</view>
        <view class="stat-label">总练习次数</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{statistics.totalTime}}</view>
        <view class="stat-label">总时长(分钟)</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{statistics.avgQuality}}</view>
        <view class="stat-label">平均质量</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{statistics.bestScore}}</view>
        <view class="stat-label">最佳评分</view>
      </view>
    </view>

    <!-- 性能监控 -->
    <view class="performance-monitor">
      <view class="monitor-title">性能监控</view>
      <view class="monitor-metrics">
        <view class="metric-item">
          <text class="metric-label">内存使用</text>
          <text class="metric-value">{{performanceMetrics.memoryUsage}}MB</text>
        </view>
        <view class="metric-item">
          <text class="metric-label">响应时间</text>
          <text class="metric-value">{{performanceMetrics.responseTime}}ms</text>
        </view>
        <view class="metric-item">
          <text class="metric-label">渲染时间</text>
          <text class="metric-value">{{performanceMetrics.renderTime}}ms</text>
        </view>
      </view>
    </view>

    <!-- 练习历史 -->
    <view class="practice-history" wx:if="{{practiceHistory.length > 0}}">
      <view class="history-title">最近练习记录</view>
      <view class="history-list">
        <view 
          wx:for="{{practiceHistory}}" 
          wx:key="id"
          class="history-item"
        >
          <view class="history-content">{{item.content || '练习记录'}}</view>
          <view class="history-meta">
            <text class="history-quality">{{item.quality}}分</text>
            <text class="history-duration">{{item.duration}}s</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 调试面板 -->
  <view class="debug-panel {{showDebugPanel ? 'open' : ''}}">
    <view class="debug-header" bindtap="toggleDebugPanel">
      <text class="debug-title">🔍 调试面板</text>
      <text class="debug-toggle">{{showDebugPanel ? '🔽' : '🔼'}}</text>
    </view>
    
    <view class="debug-content" wx:if="{{showDebugPanel}}">
      <!-- 实时日志 -->
      <view class="debug-logs">
        <view class="logs-header">
          <text class="logs-title">实时日志</text>
          <button class="clear-btn" bindtap="clearTestData">清空</button>
        </view>
        <scroll-view class="logs-container" scroll-y scroll-top="{{0}}">
          <view 
            wx:for="{{testLogs}}" 
            wx:key="index"
            class="log-item"
          >
            {{item}}
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- 底部控制栏 -->
  <view class="demo-footer">
    <button class="control-btn" bindtap="toggleDebugPanel">
      {{showDebugPanel ? '隐藏' : '显示'}}调试
    </button>
    <button class="control-btn export" bindtap="exportTestReport">
      导出报告
    </button>
    <button class="control-btn clear" bindtap="clearTestData">
      清空数据
    </button>
  </view>
</view> 